
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AI 生成类似图片</title>
  <meta name="keywords" content="Raz1ner, AI 生成图片, AI 生成类似图片, AI 模仿图片">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Raz1ner">
  <link rel="shortcut icon" href="/favicon.ico">
  <meta name="description" content="使用 AI 根据原始图片生成风格相似的图片。">
  <link rel="canonical" href="https://dev-coco.github.io/Image-to-Image/">
  <meta property="og:title" content="生成类似图片">
  <meta property="og:type" content="article">
  <meta property="og:image" content="https://dev-coco.github.io/post-images/Raz1ner.png">
  <meta property="og:url" content="https://dev-coco.github.io/World-Time/">
  <meta property="og:description" content="使用 AI 根据原始图片生成风格相似的图片。">
  <meta name="twitter:title" content="生成类似图片">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://dev-coco.github.io/post-images/Raz1ner.png">
  <meta name="twitter:description" content="使用 AI 根据原始图片生成风格相似的图片。">
  <link rel="icon" href="/images/avatar.png">
  <link rel="stylesheet" href="/css/site.css">
  <link rel="stylesheet" href="https://dev-coco.github.io/css/bootstrap.min.css">
  <script data-ad-client="ca-pub-6960947409660270" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async src="https://fundingchoicesmessages.google.com/i/pub-6960947409660270?ers=1" nonce="3szuJwRueku-LVJlmdoLew"></script><script nonce="3szuJwRueku-LVJlmdoLew">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
  <script>(function(){
   'use strict';var aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var m;a:{var ca={a:!0},n={};try{n.__proto__=ca;m=n.a;break a}catch(a){}m=!1}k=m?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
   var p=k,q=function(a,b){a.prototype=ba(b.prototype);a.prototype.constructor=a;if(p)p(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.v=b.prototype},r=this||self,da=function(){},t=function(a){return a};var u;var w=function(a,b){this.g=b===v?a:""};w.prototype.toString=function(){return this.g+""};var v={},x=function(a){if(void 0===u){var b=null;var c=r.trustedTypes;if(c&&c.createPolicy){try{b=c.createPolicy("goog#html",{createHTML:t,createScript:t,createScriptURL:t})}catch(d){r.console&&r.console.error(d.message)}u=b}else u=b}a=(b=u)?b.createScriptURL(a):a;return new w(a,v)};var A=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)};var B={},C=null;var D="function"===typeof Uint8Array;function E(a,b,c){return"object"===typeof a?D&&!Array.isArray(a)&&a instanceof Uint8Array?c(a):F(a,b,c):b(a)}function F(a,b,c){if(Array.isArray(a)){for(var d=Array(a.length),e=0;e<a.length;e++){var f=a[e];null!=f&&(d[e]=E(f,b,c))}Array.isArray(a)&&a.s&&G(d);return d}d={};for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(f=a[e],null!=f&&(d[e]=E(f,b,c)));return d}
   function ea(a){return F(a,function(b){return"number"===typeof b?isFinite(b)?b:String(b):b},function(b){var c;void 0===c&&(c=0);if(!C){C={};for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],f=0;5>f;f++){var h=d.concat(e[f].split(""));B[f]=h;for(var g=0;g<h.length;g++){var l=h[g];void 0===C[l]&&(C[l]=g)}}}c=B[c];d=Array(Math.floor(b.length/3));e=c[64]||"";for(f=h=0;h<b.length-2;h+=3){var y=b[h],z=b[h+1];l=b[h+2];g=c[y>>2];y=c[(y&3)<<
   4|z>>4];z=c[(z&15)<<2|l>>6];l=c[l&63];d[f++]=""+g+y+z+l}g=0;l=e;switch(b.length-h){case 2:g=b[h+1],l=c[(g&15)<<2]||e;case 1:b=b[h],d[f]=""+c[b>>2]+c[(b&3)<<4|g>>4]+l+e}return d.join("")})}var fa={s:{value:!0,configurable:!0}},G=function(a){Array.isArray(a)&&!Object.isFrozen(a)&&Object.defineProperties(a,fa);return a};var H;var J=function(a,b,c){var d=H;H=null;a||(a=d);d=this.constructor.u;a||(a=d?[d]:[]);this.j=d?0:-1;this.h=null;this.g=a;a:{d=this.g.length;a=d-1;if(d&&(d=this.g[a],!(null===d||"object"!=typeof d||Array.isArray(d)||D&&d instanceof Uint8Array))){this.l=a-this.j;this.i=d;break a}void 0!==b&&-1<b?(this.l=Math.max(b,a+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(c)for(b=0;b<c.length;b++)a=c[b],a<this.l?(a+=this.j,(d=this.g[a])?G(d):this.g[a]=I):(d=this.l+this.j,this.g[d]||(this.i=this.g[d]={}),(d=this.i[a])?
   G(d):this.i[a]=I)},I=Object.freeze(G([])),K=function(a,b){if(-1===b)return null;if(b<a.l){b+=a.j;var c=a.g[b];return c!==I?c:a.g[b]=G([])}if(a.i)return c=a.i[b],c!==I?c:a.i[b]=G([])},M=function(a,b){var c=L;if(-1===b)return null;a.h||(a.h={});if(!a.h[b]){var d=K(a,b);d&&(a.h[b]=new c(d))}return a.h[b]};J.prototype.toJSON=function(){var a=N(this,!1);return ea(a)};
   var N=function(a,b){if(a.h)for(var c in a.h)if(Object.prototype.hasOwnProperty.call(a.h,c)){var d=a.h[c];if(Array.isArray(d))for(var e=0;e<d.length;e++)d[e]&&N(d[e],b);else d&&N(d,b)}return a.g},O=function(a,b){H=b=b?JSON.parse(b):null;a=new a(b);H=null;return a};J.prototype.toString=function(){return N(this,!1).toString()};var P=function(a){J.call(this,a)};q(P,J);function ha(a){var b,c=(a.ownerDocument&&a.ownerDocument.defaultView||window).document,d=null===(b=c.querySelector)||void 0===b?void 0:b.call(c,"script[nonce]");(b=d?d.nonce||d.getAttribute("nonce")||"":"")&&a.setAttribute("nonce",b)};var Q=function(a,b){b=String(b);"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)},R=function(a){this.g=a||r.document||document};R.prototype.appendChild=function(a,b){a.appendChild(b)};var S=function(a,b,c,d,e,f){try{var h=a.g,g=Q(a.g,"SCRIPT");g.async=!0;g.src=b instanceof w&&b.constructor===w?b.g:"type_error:TrustedResourceUrl";ha(g);h.head.appendChild(g);g.addEventListener("load",function(){e();d&&h.head.removeChild(g)});g.addEventListener("error",function(){0<c?S(a,b,c-1,d,e,f):(d&&h.head.removeChild(g),f())})}catch(l){f()}};var ia=r.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),ja=r.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),ka=r.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),la=function(a,b,c){this.h=a;this.j=new R(this.h);this.g=null;this.i=[];this.l=!1;this.o=b;this.m=c},V=function(a){if(a.h.body&&!a.l){var b=
   function(){T(a);r.setTimeout(function(){return U(a,3)},50)};S(a.j,a.o,2,!0,function(){r[a.m]||b()},b);a.l=!0}},T=function(a){for(var b=W(1,5),c=0;c<b;c++){var d=X(a);a.h.body.appendChild(d);a.i.push(d)}b=X(a);b.style.bottom="0";b.style.left="0";b.style.position="fixed";b.style.width=W(100,110).toString()+"%";b.style.zIndex=W(2147483544,2147483644).toString();b.style["background-color"]=ma(249,259,242,252,219,229);b.style["box-shadow"]="0 0 12px #888";b.style.color=ma(0,10,0,10,0,10);b.style.display=
   "flex";b.style["justify-content"]="center";b.style["font-family"]="Roboto, Arial";c=X(a);c.style.width=W(80,85).toString()+"%";c.style.maxWidth=W(750,775).toString()+"px";c.style.margin="24px";c.style.display="flex";c.style["align-items"]="flex-start";c.style["justify-content"]="center";d=Q(a.j.g,"IMG");d.className=A();d.src=ia;d.style.height="24px";d.style.width="24px";d.style["padding-right"]="16px";var e=X(a),f=X(a);f.style["font-weight"]="bold";f.textContent=ja;var h=X(a);h.textContent=ka;Y(a,
   e,f);Y(a,e,h);Y(a,c,d);Y(a,c,e);Y(a,b,c);a.g=b;a.h.body.appendChild(a.g);b=W(1,5);for(c=0;c<b;c++)d=X(a),a.h.body.appendChild(d),a.i.push(d)},Y=function(a,b,c){for(var d=W(1,5),e=0;e<d;e++){var f=X(a);b.appendChild(f)}b.appendChild(c);c=W(1,5);for(d=0;d<c;d++)e=X(a),b.appendChild(e)},W=function(a,b){return Math.floor(a+Math.random()*(b-a))},ma=function(a,b,c,d,e,f){return"rgb("+W(Math.max(a,0),Math.min(b,255)).toString()+","+W(Math.max(c,0),Math.min(d,255)).toString()+","+W(Math.max(e,0),Math.min(f,
   255)).toString()+")"},X=function(a){a=Q(a.j.g,"DIV");a.className=A();return a},U=function(a,b){0>=b||null!=a.g&&0!=a.g.offsetHeight&&0!=a.g.offsetWidth||(na(a),T(a),r.setTimeout(function(){return U(a,b-1)},50))},na=function(a){var b=a.i;var c="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];b=c?c.call(b):{next:aa(b)};for(c=b.next();!c.done;c=b.next())(c=c.value)&&c.parentNode&&c.parentNode.removeChild(c);a.i=[];(b=a.g)&&b.parentNode&&b.parentNode.removeChild(b);a.g=null};var pa=function(a,b,c,d,e){var f=oa(c),h=function(l){l.appendChild(f);r.setTimeout(function(){f?(0!==f.offsetHeight&&0!==f.offsetWidth?b():a(),f.parentNode&&f.parentNode.removeChild(f)):a()},d)},g=function(l){document.body?h(document.body):0<l?r.setTimeout(function(){g(l-1)},e):b()};g(3)},oa=function(a){var b=document.createElement("div");b.className=a;b.style.width="1px";b.style.height="1px";b.style.position="absolute";b.style.left="-10000px";b.style.top="-10000px";b.style.zIndex="-10000";return b};var L=function(a){J.call(this,a)};q(L,J);var qa=function(a){J.call(this,a)};q(qa,J);var ra=function(a,b){this.l=a;this.m=new R(a.document);this.g=b;this.i=K(this.g,1);b=M(this.g,2);this.o=x(K(b,4)||"");this.h=!1;b=M(this.g,13);b=x(K(b,4)||"");this.j=new la(a.document,b,K(this.g,12))};ra.prototype.start=function(){sa(this)};
   var sa=function(a){ta(a);S(a.m,a.o,3,!1,function(){a:{var b=a.i;var c=r.btoa(b);if(c=r[c]){try{var d=O(P,r.atob(c))}catch(e){b=!1;break a}b=b===K(d,1)}else b=!1}b?Z(a,K(a.g,14)):(Z(a,K(a.g,8)),V(a.j))},function(){pa(function(){Z(a,K(a.g,7));V(a.j)},function(){return Z(a,K(a.g,6))},K(a.g,9),K(a.g,10),K(a.g,11))})},Z=function(a,b){a.h||(a.h=!0,a=new a.l.XMLHttpRequest,a.open("GET",b,!0),a.send())},ta=function(a){var b=r.btoa(a.i);a.l[b]&&Z(a,K(a.g,5))};(function(a,b){r[a]=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];r[a]=da;b.apply(null,d)}})("__h82AlnkH6D91__",function(a){"function"===typeof window.atob&&(new ra(window,O(qa,window.atob(a)))).start()});}).call(this);
   window.__h82AlnkH6D91__("WyJwdWItNjk2MDk0NzQwOTY2MDI3MCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi02OTYwOTQ3NDA5NjYwMjcwIl0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hWWkh4UHVLbUVuYUVHcDZmcldNVTVHZloyVUxJZW8zcHZhaV9wUVJ5a2M4dmlkZlVwMENZeVJQZEQxdExOQzRkOUN6cEQxS1hFZml1cnFJZXFIOVVsc1R3XHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFhUNmRjRFppendkR2FaMmQ2dHBOMEF3TWowNERwVWVBaUd4Y1lsNXR1UWZFdmhDSTZmaWRxcEN3RXNQeGF1eWJUc004eFlhVWFLSWJENnNWdVIyNXIwT0FcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFVFeld6ZVhfYjlBSnJsR05ab2N0MG1UVHBKZFUxQVo1b2piaVNXMXc4TjNJdG93TndOZ2YtNzcwOVNEQUlrSWlUbW5UU2hvVW5DYml0QmVYVTM4Z3M3c2dcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFVWdXc5Q2tNRzNoX3p2WGJHcHlLdU95cE4weWVabEVVSmVsbFBnR2F4Y3NockhWdklpSmlPMzZKM3JhRlhDSl9fdnp2U0ZuRFNXS3dPUXl5enpLWG5zc0FcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUWTVOakE1TkRjME1EazJOakF5TnpBXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi02OTYwOTQ3NDA5NjYwMjcwLmpzP3VzcXBcdTAwM2RDQXciXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4V0M5M05iUXBSTC12eTBWbXd3TjBwVllQTDE5eDJLYWJfQkFZYjVucWlRM0VZTTJ0ZXRQMHJxRzE5ZHF5X3NfZjh6VmhPc0ZIWExmeVJGUnJJTEhSak5aZ1x1MDAzZFx1MDAzZCJd");</script>
  <style>:root{--bs-primary:#6366f1;--bs-primary-darker:#4f46e5}.page-title{color:var(--bs-primary)}.drop-area{height:300px;border:3px dashed #e5e7eb;border-radius:12px;background-color:#f9fafb;transition:all .3s ease;cursor:pointer;overflow:hidden;position:relative}.drop-area:hover{border-color:var(--bs-primary)}.drop-area.active{border-color:var(--bs-primary);background-color:rgba(99,102,241,.05)}.drop-text{color:#6b7280}.drop-icon{font-size:3rem;color:var(--bs-primary)}.preview-image{max-width:100%;max-height:100%;object-fit:contain;position:absolute;z-index:10;visibility:hidden}.visible{visibility:visible}.btn-primary{background-color:var(--bs-primary);border-color:var(--bs-primary)}.btn-primary:hover{background-color:var(--bs-primary-darker);border-color:var(--bs-primary-darker)}.loading{display:none;width:40px;height:40px;border:5px solid rgba(99,102,241,.2);border-radius:50%;border-top-color:var(--bs-primary);animation:spin 1s ease-in-out infinite;margin:0 auto}@keyframes spin{to{transform:rotate(360deg)}}.info-header{color:var(--bs-primary)}.direction-arrow{font-size:2rem;color:var(--bs-primary)}</style>
</head>
<body>
  <div class="container">
    <h1 class="text-start pt-3">
      <img class="logo" alt="Raz1ner" src="/images/avatar.png">
      <span> Raz1ner</span>
      <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdev-coco.github.io&count_bg=%2310C1F9&title_bg=%23555555&icon=html5.svg&icon_color=%23E7E7E7&title=%E8%AE%BF%E9%97%AE%E4%BA%BA%E6%95%B0&edge_flat=false" style="float:right;width:180px;">
    </h1>
    <div class="menu">
      <a href="/">首页</a>
      <a href="/Navigation/">导航</a>
      <a href="/Featured-Software.html">软件</a>
      <a href="/post/Chrome-Extension-Collection/">插件</a>
      <a href="/Online-Tools">在线工具</a>
      <a href="/post/Linux-Command">Linux命令</a>
      <a href="/Excel/">Excel教程</a>
      <a href="/post/Terms-and-Privacy">隐私与条款</a>
      <a target="_blank" href="https://github.com/dev-coco">Github</a>
    </div>
    <div class="container py-4">
      <header class="text-center mb-5">
        <h1 class="page-title mb-2">AI 图片生成</h1>
        <p class="text-secondary">上传图像并使用 AI 生成类似图像</p>
      </header>
      <div class="row mb-4">
        <div class="col-md-5">
          <div class="d-flex flex-column h-100">
            <h5 class="fw-semibold mb-3 text-center">原始图片</h5>
            <div id="source-drop-area" class="drop-area d-flex flex-column justify-content-center align-items-center">
              <div class="drop-icon mb-2">🖼️</div>
              <p class="drop-text text-center px-3">将图像拖放到此处 或 点击选择</p>
              <img id="source-preview" class="preview-image" src="#" alt="原始图片">
              <input type="file" id="source-file-input" hidden accept="image/*">
            </div>
          </div>
        </div>
        <div class="col-md-2 d-flex justify-content-center align-items-center">
          <div class="direction-arrow d-none d-md-block">→</div>
        </div>
        <div class="col-md-5">
          <div class="d-flex flex-column h-100">
            <h5 class="fw-semibold mb-3 text-center">生成的图片</h5>
            <div id="result-area" class="drop-area d-flex flex-column justify-content-center align-items-center">
              <div class="drop-icon mb-2">✨</div>
              <p class="drop-text text-center px-3">显示生成后的图片</p>
              <img id="result-preview" class="preview-image" src="#" alt="预览结果">
              <div class="loading" id="loading-indicator"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="text-center mb-5">
        <button id="generate-btn" class="btn btn-primary btn-lg px-4">生成图片</button>
      </div>
      <div class="row">
        <div class="col-12 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="info-header fw-semibold mb-3">原始图片提示词</h5>
              <textarea id="prompt-area" class="form-control" rows="4" placeholder="用于生成图像的提示将出现在这里..."></textarea>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <h5 class="info-header fw-semibold mb-0 me-2">Gemini API Key</h5>
                <a href="https://dev-coco.github.io/post/Apply-Gemini-API-Key/">申请 API Key</a>
              </div>
              <input type="text" id="api-token" class="form-control" placeholder="在这里输入 Gemini API Key。">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const sourceDropArea = document.getElementById('source-drop-area')
    const sourcePreview = document.getElementById('source-preview')
    const sourceFileInput = document.getElementById('source-file-input')
    const generateBtn = document.getElementById('generate-btn')
    const promptArea = document.getElementById('prompt-area')
    const apiToken = document.getElementById('api-token')
    const loadingIndicator = document.getElementById('loading-indicator')
    const resultPreview = document.getElementById('result-preview')

    let imageBase64 = ''

    // 处理拖放事件
    ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      sourceDropArea.addEventListener(eventName, preventDefaults, false)
    })

    function preventDefaults (e) {
      e.preventDefault()
      e.stopPropagation()
    }

    // 当项目被拖到放置区域上时突出显示该区域
    ['dragenter', 'dragover'].forEach(eventName => {
      sourceDropArea.addEventListener(eventName, () => {
        sourceDropArea.classList.add('active')
      }, false)
    })

    ;['dragleave', 'drop'].forEach(eventName => {
      sourceDropArea.addEventListener(eventName, () => {
        sourceDropArea.classList.remove('active')
      }, false)
    })

    // 处理丢弃的文件
    sourceDropArea.addEventListener('drop', (e) => {
      const dt = e.dataTransfer
      const files = dt.files
      handleFiles(files)
    }, false)

    // 处理点击的文件输入
    sourceDropArea.addEventListener('click', () => {
      sourceFileInput.click()
    })

    sourceFileInput.addEventListener('change', () => {
      handleFiles(sourceFileInput.files)
    })

    // 处理文件
    function handleFiles (files) {
      if (files.length > 0) {
        const file = files[0]
        if (file.type.match('image.*')) {
          const reader = new FileReader()

          reader.onload = (e) => {
          // 储存 base64 数据
            imageBase64 = e.target.result

            // 显示图片
            sourcePreview.src = imageBase64
            sourcePreview.classList.add('visible')

            // 隐藏占位符文本和图标
            sourceDropArea.querySelector('.drop-text').style.display = 'none'
          }
          reader.readAsDataURL(file)
        } else {
          alert('Please upload an image file.')
        }
      }
    }

    const reasonList = {
      FINISH_REASON_UNSPECIFIED: '默认值。此值未使用。',
      STOP: '模型的自然停止点或提供的停止序列。',
      MAX_TOKENS: '已达到请求中指定的词元数量上限。',
      SAFETY: '出于安全考虑，系统已标记回答候选内容。',
      RECITATION: '由于背诵原因，回答候选内容被标记。',
      LANGUAGE: '回答候选内容因使用不受支持的语言而被标记。',
      OTHER: '原因未知。',
      BLOCKLIST: '由于内容包含禁止使用的字词，因此 token 生成操作已停止。',
      PROHIBITED_CONTENT: '由于可能包含禁止的内容，因此 token 生成操作已停止。',
      SPII: '由于内容可能包含敏感的个人身份信息 (SPII)，因此 token 生成操作已停止。',
      MALFORMED_FUNCTION_CALL: '模型生成的函数调用无效。',
      IMAGE_SAFETY: '由于生成的图片违反了安全规定，因此词元生成已停止。'
    }

    generateBtn.addEventListener('click', async () => {
      if (!imageBase64) return alert('请先放入原始图片')
      if (!apiToken.value) return alert('请先放入 API Key')

      promptArea.value = ''
      resultPreview.classList.remove('visible')

      // 显示加载动画
      loadingIndicator.style.display = 'block'
      generateBtn.disabled = true

      // 图片提示词
      const imagePromptResult = await getImagePrompt(imageBase64)
      // 检测违规内容
      if (imagePromptResult.finishReason === 'STOP') {
        promptArea.value = imagePromptResult.imagePrompt

        // 生成类似图片
        const result = await generateImage()
        // 检测违规内容
        if (result.finishReason === 'STOP') {
          resultPreview.src = result.imageData
        } else {
          alert(reasonList[result.finishReason])
        }
      } else {
        alert(reasonList[imagePromptResult.finishReason])
      }

      // 隐藏动画
      loadingIndicator.style.display = 'none'
      generateBtn.disabled = false

      resultPreview.classList.add('visible')
      document.getElementById('result-area').querySelector('.drop-text').style.display = 'none'
    })

    // 点击下载图片
    resultPreview.addEventListener('click', () => {
    // resultPreview.src
      const link = document.createElement('a')
      link.href = resultPreview.src
      link.download = `${Date.now()}.png`
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
    })

    // 获取图片提示词
    async function getImagePrompt () {
      try {
        const payload = {
          contents: [{
            parts: [
              { text: "You are a seasoned image generation expert tasked with creating detailed, precise, and richly layered image prompts based on the provided descriptions. Your output should adhere to the following guidelines:\n\nAccurately and vividly depict the scene's background, environmental elements, and the interplay of light and shadow (e.g., skies, clouds, distant mountains, city lights, or natural landscapes).\n\nClearly describe the main subjects or characters, including their appearance, clothing details, posture, emotions, and any prominent symbols or text (such as religious motifs or slogans).\n\nEmphasize the use of color, composition, and artistic style, blending realistic detail with elements that evoke styles such as impressionism where appropriate, to create a visually rich and dynamic scene.\n\nStructure the description in a layered manner that captures both the overall atmosphere and the intricate details, ensuring a prompt that enables the image generation tool to achieve high fidelity and strong visual impact.\n\nBased on the input, generate a refined image prompt that encapsulates all these elements. Generate 1080*1080 image." },
              {
                inline_data: {
                  mime_type: imageBase64.split(',')[0].replace(/.+:|;.+/g, ''),
                  data: imageBase64.split(',')[1]
                }
              }
            ]
          }]
        }
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiToken.value}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        })
        const json = await response.json()
        const finishReason = json.candidates[0].finishReason
        if (finishReason === 'STOP') {
          return {
            finishReason,
            imagePrompt: json.candidates[0].content.parts[0].text
          }
        } else {
          return { finishReason }
        }
      } catch (error) {
        console.error('Error sending image to Gemini:', error)
        throw error
      }
    }

    // 生成图片
    async function generateImage () {
      const requestData = {
        contents: [{
          parts: [
            { text: promptArea.value }
          ]
        }],
        generationConfig: { responseModalities: ['Text', 'Image'] }
      }
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp-image-generation:generateContent?key=${apiToken.value}`, {
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestData),
          method: 'POST'
        })

        const json = await response.json()
        const finishReason = json.candidates[0].finishReason
        if (finishReason === 'STOP') {
          const inlineData = json.candidates[0].content.parts[0].inlineData
          return {
            finishReason,
            imageData: `data:${inlineData.mimeType};base64,${inlineData.data}`
          }
        } else {
          return { finishReason }
        }
      } catch (error) {
        console.error('Error generating image:', error)
      }
    }
  </script>
  <!-- <script>(location.href.includes('dev-coco.github.io')||location.href.includes('localhost'))?'':window.open('https'+'://dev'+'-coco'+'.github.io/','_self')</script> -->
</body>
</html>