<!DOCTYPE html>
<html lang="zh">
<head>
    <title>semanage:默认目录的安全上下文查询与修改</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="keywords" content="dev-coco, Linux命令手册, Linux命令"/>
    <meta name="robots" content="index,follow"/>
    <meta name="description" content="semanage:默认目录的安全上下文查询与修改 — 最专业的Linux命令大全"/>
    <link rel="icon" href="https://dev-coco.github.io/images/WebIcon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://dev-coco.github.io/js/love.js" async="async"></script>
    <link rel="stylesheet" href="https://dev-coco.github.io/css/site.css">
</head>
<body>
    <div class="container">
<h1 style="text-align:left;"><img class="logo" alt="dev-coco" src="https://dev-coco.github.io/images/WebIcon.png"> Dev-Coco</h1>
<div class="menu">
  <a href="https://dev-coco.github.io/">主页</a>
  <a href="https://dev-coco.github.io/blog">博客</a>
  <a href="https://dev-coco.github.io/Featured-Software.html">软件</a>
  <a href="https://dev-coco.github.io/Online-Tools/">在线工具</a>
  <a href="https://dev-coco.github.io/Linux-Command/">Linux命令</a>
  <a href="https://dev-coco.github.io/Terms-and-Privacy.html">隐私与条款</a>
  <a target="_blank" href="https://github.com/dev-coco">Github</a>
</div>
<h1>semanage</h1><p>默认目录的安全上下文查询与修改</p>
<h2>补充说明</h2><p><strong>semanage命令</strong> 是用来查询与修改SELinux默认目录的安全上下文。SELinux的策略与规则管理相关命令：seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令。</p>
<h3>语法</h3><pre><code>semanage <span>{</span>login<span>|</span>user<span>|</span>port<span>|</span>interface<span>|</span>fcontext<span>|</span>translation<span>}</span> -l
semanage fcontext -<span>{</span>a<span>|</span>d<span>|</span>m<span>}</span> <span>[</span>-frst<span>]</span> file_spec</code></pre>
<h3>选项</h3><pre><code>-l：查询。
fcontext：主要用在安全上下文方面。
-a：增加，你可以增加一些目录的默认安全上下文类型设置。
-m：修改。
-d：删除。</code></pre>
<h3>实例</h3><p>查询一下<code>/var/www/html</code>的默认安全性本文的设置：</p>
<pre><code>semanage fcontext -l
SELinux fcontext    <span>type</span>          Context
<span>..</span><span>..</span><span>(</span>前面省略<span>)</span><span>..</span><span>..</span>
/var/www<span>(</span>/.*<span>)</span>?      all files     system_u:object_r:httpd_sys_content_t:s0
<span>..</span><span>..</span><span>(</span>後面省略<span>)</span><span>..</span><span>..</span></code></pre>
<p>如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？举例来说，我想要色设置<code>/srv/samba</code>成为 <code>public_content_t</code>的类型时，应该如何设置呢？</p>
<p>用semanage命令设置<code>/srv/samba</code>目录的默认安全性本文为<code>public_content_t</code>：</p>
<pre><code><span>mkdir</span> /srv/samba
ll -Zd /srv/samba
drwxr-xr-x  root root root:object_r:var_t    /srv/samba</code></pre>
<p>如上所示，默认的情况应该是<code>var_t</code>这个咚咚的！</p>
<pre><code>semanage fcontext -l <span>|</span> <span>grep</span> <span>'/srv'</span>
/srv/.*                     all files   system_u:object_r:var_t:s0
/srv/<span>(</span><span>[</span>^/<span>]</span>*/<span>)</span>?ftp<span>(</span>/.*<span>)</span>?     all files   system_u:object_r:public_content_t:s0
/srv/<span>(</span><span>[</span>^/<span>]</span>*/<span>)</span>?www<span>(</span>/.*<span>)</span>?     all files   system_u:object_r:httpd_sys_content_t:s0
/srv/<span>(</span><span>[</span>^/<span>]</span>*/<span>)</span>?rsync<span>(</span>/.*<span>)</span>?   all files   system_u:object_r:public_content_t:s0
/srv/gallery2<span>(</span>/.*<span>)</span>?         all files   system_u:object_r:httpd_sys_content_t:s0
/srv                        directory   system_u:object_r:var_t:s0   //看这里！</code></pre>
<p>上面则是默认的<code>/srv</code>底下的安全性本文资料，不过，并没有指定到<code>/srv/samba</code>。</p>
<pre><code>semanage fcontext -a -t public_content_t <span>"/srv/samba(/.*)?"</span>
semanage fcontext -l <span>|</span> <span>grep</span> <span>'/srv/samba'</span>
/srv/samba<span>(</span>/.*<span>)</span>?            all files   system_u:object_r:public_content_t:s0</code></pre>
<pre><code><span>cat</span> /etc/selinux/targeted/contexts/files/file_contexts.local
<span># This file is auto-generated by libsemanage</span>
<span># Please use the semanage command to make changes</span>
/srv/samba<span>(</span>/.*<span>)</span>?    system_u:object_r:public_content_t:s0  <span>#写入这个档案</span></code></pre>
<pre><code>restorecon -Rv /srv/samba* <span>#尝试恢复默认值</span>
ll -Zd /srv/samba
drwxr-xr-x  root root system_u:object_r:public_content_t /srv/samba/  <span>#有默认值，以后用restorecon命令来修改比较简单！</span></code></pre>
<p>semanage命令的功能很多，这里主要用到的仅有fcontext这个选项的用法而已。如上所示，你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！</p>
<p style="text-align:right"><a href="https://dev-coco.github.io/Linux-Command/"><img alt="Linux命令, Linux命令手册" src="https://dev-coco.github.io/images/Linux-Penguin-Icon.png" style="width:48px" />Linux命令手册</a></p>
        </div>
</body>
</html>
